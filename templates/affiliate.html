{% extends "layout.html" %}
{% block title %}Affiliate Program - Just.Trades.{% endblock %}
{% block page_title %}AFFILIATE PROGRAM{% endblock %}

{% block styles %}
<link rel="stylesheet" href="/static/css/affiliate.css">
{% endblock %}

{% block content %}

<!-- Hero Section -->
<section class="aff-hero aff-fadeUp" style="animation-delay: 0.1s">
    <div class="aff-hero-inner">
        <h1 class="aff-hero-heading">
            Earn Recurring Commissions<br>with <span class="aff-gradient-text">Just.Trades.</span>
        </h1>
        <p class="aff-hero-subtitle">
            Join our affiliate program and earn 25% recurring commission on every trader you refer.
            Real payouts, real-time tracking, no limits.
        </p>
        <div class="aff-hero-cta">
            <a href="#link-section" class="aff-btn aff-btn-primary">
                <i class="material-icons">attach_money</i>
                Start Earning
            </a>
            <a href="#how-it-works" class="aff-btn aff-btn-outline">
                <i class="material-icons">play_circle_outline</i>
                See How It Works
            </a>
        </div>
    </div>
</section>

<!-- Stats Row -->
<section class="aff-stats-row aff-fadeUp" style="animation-delay: 0.2s">
    <div class="aff-stat-card">
        <div class="aff-stat-value">25%</div>
        <div class="aff-stat-label">Recurring Commission</div>
    </div>
    <div class="aff-stat-card">
        <div class="aff-stat-value">30 Days</div>
        <div class="aff-stat-label">Cookie Duration</div>
    </div>
    <div class="aff-stat-card">
        <div class="aff-stat-value">Monthly</div>
        <div class="aff-stat-label">Payouts</div>
    </div>
    <div class="aff-stat-card">
        <div class="aff-stat-value">Real-Time</div>
        <div class="aff-stat-label">Tracking Dashboard</div>
    </div>
</section>

<!-- How It Works -->
<section class="aff-how-it-works aff-fadeUp" id="how-it-works" style="animation-delay: 0.3s">
    <h2 class="aff-section-heading">How It Works</h2>
    <div class="aff-steps-row">
        <div class="aff-step-card">
            <div class="aff-step-number">1</div>
            <div class="aff-step-icon">
                <i class="material-icons">person_add</i>
            </div>
            <h3 class="aff-step-title">Sign Up</h3>
            <p class="aff-step-desc">Create your free affiliate account and get your unique referral link instantly.</p>
        </div>
        <div class="aff-step-connector">
            <i class="material-icons">arrow_forward</i>
        </div>
        <div class="aff-step-card">
            <div class="aff-step-number">2</div>
            <div class="aff-step-icon">
                <i class="material-icons">share</i>
            </div>
            <h3 class="aff-step-title">Share Your Link</h3>
            <p class="aff-step-desc">Share your referral link with your audience — social media, YouTube, Discord, blog, email.</p>
        </div>
        <div class="aff-step-connector">
            <i class="material-icons">arrow_forward</i>
        </div>
        <div class="aff-step-card">
            <div class="aff-step-number">3</div>
            <div class="aff-step-icon">
                <i class="material-icons">payments</i>
            </div>
            <h3 class="aff-step-title">Get Paid</h3>
            <p class="aff-step-desc">Earn 25% recurring commission every month for as long as your referrals stay subscribed.</p>
        </div>
    </div>
</section>

<!-- Commission Breakdown -->
<section class="aff-tiers aff-fadeUp" style="animation-delay: 0.4s">
    <h2 class="aff-section-heading">Commission Breakdown</h2>
    <div class="aff-tiers-grid">
        <div class="aff-tier-card">
            <div class="aff-tier-badge">Basic+</div>
            <div class="aff-tier-price">$200<span>/mo</span></div>
            <div class="aff-tier-arrow">
                <i class="material-icons">arrow_forward</i>
            </div>
            <div class="aff-tier-earn">
                <span class="aff-tier-earn-label">You earn</span>
                <span class="aff-tier-earn-amount">$50<span>/mo</span></span>
                <span class="aff-tier-earn-sub">per referral</span>
            </div>
        </div>
        <div class="aff-tier-card aff-tier-featured">
            <div class="aff-tier-badge">Premium+</div>
            <div class="aff-tier-price">$500<span>/mo</span></div>
            <div class="aff-tier-arrow">
                <i class="material-icons">arrow_forward</i>
            </div>
            <div class="aff-tier-earn">
                <span class="aff-tier-earn-label">You earn</span>
                <span class="aff-tier-earn-amount">$125<span>/mo</span></span>
                <span class="aff-tier-earn-sub">per referral</span>
            </div>
        </div>
        <div class="aff-tier-card">
            <div class="aff-tier-badge">Elite+</div>
            <div class="aff-tier-price">$1,000<span>/mo</span></div>
            <div class="aff-tier-arrow">
                <i class="material-icons">arrow_forward</i>
            </div>
            <div class="aff-tier-earn">
                <span class="aff-tier-earn-label">You earn</span>
                <span class="aff-tier-earn-amount">$250<span>/mo</span></span>
                <span class="aff-tier-earn-sub">per referral</span>
            </div>
        </div>
    </div>
    <p class="aff-tiers-note">
        <i class="material-icons">info_outline</i>
        Commissions are recurring — you earn every month your referral stays active.
    </p>
</section>

<!-- Referral Link Section -->
<section class="aff-link-section aff-fadeUp" id="link-section" style="animation-delay: 0.5s">
    {% if affiliate_code %}
    <div class="aff-link-card">
        <h2 class="aff-section-heading">Your Referral Link</h2>
        <p class="aff-link-subtitle">Share this link to start earning. Every signup within 30 days earns you 25%.</p>

        <div class="aff-link-input-row">
            <input
                type="text"
                id="referralLinkInput"
                class="aff-link-input"
                value="{{ referral_link }}"
                readonly
            >
            <button class="aff-copy-btn" id="copyBtn" onclick="copyReferralLink()">
                <i class="material-icons" id="copyIcon">content_copy</i>
                <span id="copyLabel">Copy</span>
            </button>
        </div>

        <div class="aff-share-row">
            <span class="aff-share-label">Share on:</span>
            <button class="aff-share-btn aff-share-x" onclick="shareOnX()">
                <svg class="aff-x-icon" viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-4.714-6.231-5.401 6.231H2.744l7.73-8.835L1.254 2.25H8.08l4.259 5.631 5.905-5.631zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                </svg>
                Share on X
            </button>
            <button class="aff-share-btn aff-share-email" onclick="shareViaEmail()">
                <i class="material-icons">email</i>
                Share via Email
            </button>
        </div>
    </div>
    {% else %}
    <div class="aff-apply-card">
        <div class="aff-apply-icon">
            <i class="material-icons">rocket_launch</i>
        </div>
        <h2 class="aff-section-heading">Ready to Start Earning?</h2>
        <p class="aff-apply-subtitle">
            Apply to the Just.Trades affiliate program. It's free, instant, and there's no cap on earnings.
        </p>
        <form class="aff-apply-form" id="affiliateApplyForm">
            <div class="aff-apply-fields">
                <div class="aff-field-group">
                    <label for="applyName">Full Name *</label>
                    <input type="text" id="applyName" name="name" required placeholder="Your full name">
                </div>
                <div class="aff-field-group">
                    <label for="applyEmail">Email Address *</label>
                    <input type="email" id="applyEmail" name="email" required placeholder="your@email.com">
                </div>
                <div class="aff-field-group">
                    <label for="applyAudience">How will you promote Just.Trades? *</label>
                    <textarea id="applyAudience" name="audience" rows="3" required placeholder="Social media, YouTube, Discord, blog, email newsletter..."></textarea>
                </div>
            </div>
            <button type="submit" class="aff-btn aff-btn-primary aff-apply-submit" id="applySubmitBtn">
                <i class="material-icons">send</i>
                Apply Now
            </button>
        </form>
    </div>
    {% endif %}
</section>

<!-- FAQ Section -->
<section class="aff-faq aff-fadeUp" style="animation-delay: 0.6s">
    <h2 class="aff-section-heading">Frequently Asked Questions</h2>
    <div class="aff-faq-grid">
        <div class="aff-faq-card">
            <div class="aff-faq-q">
                <i class="material-icons">help_outline</i>
                How much can I earn?
            </div>
            <p class="aff-faq-a">You earn 25% recurring commission. Refer 10 Premium+ users = $1,250/month, every month.</p>
        </div>
        <div class="aff-faq-card">
            <div class="aff-faq-q">
                <i class="material-icons">help_outline</i>
                How do I get paid?
            </div>
            <p class="aff-faq-a">Commissions are paid monthly via the payment method on your account.</p>
        </div>
        <div class="aff-faq-card">
            <div class="aff-faq-q">
                <i class="material-icons">help_outline</i>
                How long does the cookie last?
            </div>
            <p class="aff-faq-a">30 days. If someone clicks your link and signs up within 30 days, you get credit.</p>
        </div>
        <div class="aff-faq-card">
            <div class="aff-faq-q">
                <i class="material-icons">help_outline</i>
                Do I need a website?
            </div>
            <p class="aff-faq-a">No. Share on social media, Discord, YouTube, email — whatever works for your audience.</p>
        </div>
        <div class="aff-faq-card">
            <div class="aff-faq-q">
                <i class="material-icons">help_outline</i>
                When do I start earning?
            </div>
            <p class="aff-faq-a">Immediately. As soon as your referral subscribes to a paid plan, your commission starts.</p>
        </div>
        <div class="aff-faq-card">
            <div class="aff-faq-q">
                <i class="material-icons">help_outline</i>
                Is there a limit?
            </div>
            <p class="aff-faq-a">No cap on earnings. The more you refer, the more you earn.</p>
        </div>
    </div>
</section>

<!-- CTA Footer -->
<section class="aff-cta-footer aff-fadeUp" style="animation-delay: 0.7s">
    <div class="aff-cta-inner">
        <h2 class="aff-cta-heading">Ready to Start Earning?</h2>
        <p class="aff-cta-sub">Join hundreds of affiliates already earning with Just.Trades.</p>
        <a href="#link-section" class="aff-btn aff-btn-primary aff-btn-lg">
            <i class="material-icons">attach_money</i>
            Get Your Referral Link
        </a>
    </div>
</section>

{% endblock %}

{% block scripts %}
<script>
    function copyReferralLink() {
        const input = document.getElementById('referralLinkInput');
        const btn = document.getElementById('copyBtn');
        const icon = document.getElementById('copyIcon');
        const label = document.getElementById('copyLabel');

        input.select();
        input.setSelectionRange(0, 99999);

        navigator.clipboard.writeText(input.value).then(function() {
            icon.textContent = 'check_circle';
            label.textContent = 'Copied!';
            btn.classList.add('aff-copy-btn--success');

            setTimeout(function() {
                icon.textContent = 'content_copy';
                label.textContent = 'Copy';
                btn.classList.remove('aff-copy-btn--success');
            }, 2000);
        }).catch(function() {
            // Fallback for older browsers
            document.execCommand('copy');
            icon.textContent = 'check_circle';
            label.textContent = 'Copied!';
            btn.classList.add('aff-copy-btn--success');

            setTimeout(function() {
                icon.textContent = 'content_copy';
                label.textContent = 'Copy';
                btn.classList.remove('aff-copy-btn--success');
            }, 2000);
        });
    }

    function shareOnX() {
        var referralLink = document.getElementById('referralLinkInput').value;
        var text = encodeURIComponent(
            'Check out @JustTrades — automated futures trading execution. Use my link: ' + referralLink
        );
        var url = 'https://twitter.com/intent/tweet?text=' + text;
        window.open(url, '_blank', 'width=600,height=400');
    }

    function shareViaEmail() {
        var referralLink = document.getElementById('referralLinkInput').value;
        var subject = encodeURIComponent('Check out Just.Trades — Automated Futures Trading');
        var body = encodeURIComponent(
            'Hey,\n\nI\'ve been using Just.Trades for automated futures trading and thought you might find it useful.\n\n' +
            'It automates trade execution from TradingView alerts directly to your broker — no manual entry needed.\n\n' +
            'Sign up using my referral link and get started:\n' + referralLink + '\n\nCheers'
        );
        window.location.href = 'mailto:?subject=' + subject + '&body=' + body;
    }

    {% if not affiliate_code %}
    document.addEventListener('DOMContentLoaded', function() {
        var form = document.getElementById('affiliateApplyForm');
        if (!form) return;

        form.addEventListener('submit', function(e) {
            e.preventDefault();

            var name = document.getElementById('applyName').value.trim();
            var email = document.getElementById('applyEmail').value.trim();
            var audience = document.getElementById('applyAudience').value.trim();

            if (!name || !email || !audience) {
                alert('Please fill in all required fields.');
                return;
            }

            var btn = document.getElementById('applySubmitBtn');
            btn.disabled = true;
            btn.innerHTML = '<i class="material-icons">hourglass_empty</i> Submitting...';

            fetch('/api/affiliate/apply', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    name: name,
                    email: email,
                    audience: audience
                })
            })
            .then(function(r) { return r.json(); })
            .then(function(result) {
                if (result.success) {
                    form.innerHTML =
                        '<div class="aff-apply-success">' +
                        '<i class="material-icons">check_circle</i>' +
                        '<strong>Application submitted!</strong>' +
                        '<p>We\'ll review your application and get back to you soon.</p>' +
                        '</div>';
                } else {
                    alert(result.error || 'Failed to submit application. Please try again.');
                    btn.disabled = false;
                    btn.innerHTML = '<i class="material-icons">send</i> Apply Now';
                }
            })
            .catch(function() {
                alert('Network error. Please try again.');
                btn.disabled = false;
                btn.innerHTML = '<i class="material-icons">send</i> Apply Now';
            });
        });
    });
    {% endif %}
</script>
{% endblock %}
