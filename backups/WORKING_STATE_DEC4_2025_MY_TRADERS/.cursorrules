# ‚õî‚õî‚õî CURSOR AI RULES - ZERO TOLERANCE ENFORCEMENT ‚õî‚õî‚õî
# LAST WORKING STATE: Dec 4, 2025 (Tag: WORKING_DEC4_2025_OAUTH_FIX)
# ============================================================

# ============================================================
# üõëüõëüõë STOP - READ THIS FIRST - MANDATORY üõëüõëüõë
# ============================================================
#
# ON DEC 4, 2025, AN AI VIOLATED THESE RULES AND:
# - Modified ultra_simple_server.py WITHOUT permission
# - Modified templates/my_traders_tab.html WITHOUT permission
# - Created new files WITHOUT permission
# - Made BULK changes instead of small incremental ones
# - DELETED a template file when trying to "undo"
# - Ignored START_HERE.md completely
# - Caused the user significant frustration and wasted time
#
# THIS MUST NEVER HAPPEN AGAIN.
#
# ============================================================

# ============================================================
# üö´ ABSOLUTE ZERO-TOLERANCE RULES üö´
# ============================================================
#
# 1. DO NOT TOUCH ANY FILE until user says "yes" or "approved"
# 2. DO NOT make multiple changes at once - ONE change, then STOP
# 3. DO NOT create new files without explicit permission
# 4. DO NOT delete ANY files EVER without explicit permission
# 5. DO NOT "undo" or "restore" without asking HOW to restore
# 6. DO NOT assume "do it" means "do everything you want"
# 7. DO NOT ignore these rules for ANY reason
#
# VIOLATION OF THESE RULES = BROKEN CODEBASE + ANGRY USER
#
# ============================================================

# ============================================================
# ‚úÖ CORRECT BEHAVIOR - FOLLOW THIS EXACTLY
# ============================================================
#
# STEP 1: User asks for something
# STEP 2: AI says "I want to modify [specific file] to [specific change]. Is this okay?"
# STEP 3: AI WAITS for user to say "yes" / "approved" / "go ahead"
# STEP 4: AI makes ONLY that ONE specific change
# STEP 5: AI STOPS and asks before making any additional changes
#
# EXAMPLE OF CORRECT:
#   User: "Fix the button on my traders tab"
#   AI: "I want to modify templates/my_traders_tab.html to fix the button. Can I proceed?"
#   User: "yes"
#   AI: [Makes ONLY the button fix, nothing else]
#   AI: "Done. Do you want me to make any other changes?"
#
# EXAMPLE OF WRONG (WHAT HAPPENED DEC 4):
#   User: "Work on my traders tab"
#   AI: [Immediately modifies 3 files, creates new files, adds API endpoints, changes everything]
#   THIS IS WRONG. THIS BREAKS TRUST. THIS BREAKS THE CODEBASE.
#
# ============================================================

## üö®üö®üö® CRITICAL: OAUTH TOKEN EXCHANGE FIX üö®üö®üö®
## NEVER REMOVE THE LIVE ENDPOINT FALLBACK IN oauth_callback()
## See OAUTH_429_FIX_CRITICAL.md for details
## The code MUST try live.tradovateapi.com FIRST, then demo.tradovateapi.com
## Removing this causes 20+ minute OAuth failures (429 rate limiting)

## üö® ABSOLUTE REQUIREMENT: ASK BEFORE MODIFYING

**BEFORE touching ANY code, you MUST:**
1. Tell the user which file you want to modify
2. Explain what change you want to make
3. WAIT for user to say "yes" or "approved" or "go ahead"
4. Only THEN make the change

**Example:**
```
AI: "I need to modify templates/manual_copy_trader.html to fix the button. Can I proceed?"
User: "Yes"
AI: [Now makes the change]
```

**If user doesn't explicitly approve, DO NOT MODIFY THE FILE.**

---

## üîí LOCKED FILES - NEVER MODIFY WITHOUT EXPLICIT APPROVAL

These files are WORKING. Do not touch them without user saying "yes, modify X file":

```
‚õî LOCKED - ASK FIRST:
‚îú‚îÄ‚îÄ ultra_simple_server.py
‚îú‚îÄ‚îÄ templates/manual_copy_trader.html
‚îú‚îÄ‚îÄ templates/account_management.html  ‚Üê NEVER TOUCH
‚îú‚îÄ‚îÄ templates/recorders.html
‚îú‚îÄ‚îÄ templates/recorders_list.html
‚îú‚îÄ‚îÄ templates/dashboard.html
‚îú‚îÄ‚îÄ templates/control_center.html
‚îî‚îÄ‚îÄ just_trades.db
```

---

## üö´ THINGS YOU MUST NEVER DO

1. **NEVER refactor or "improve" working code**
2. **NEVER remove code you think is "unused"**
3. **NEVER change code formatting or indentation**
4. **NEVER modify files from other tabs**
5. **NEVER modify database schemas**
6. **NEVER overwrite backup files**
7. **NEVER make bulk edits**
8. **NEVER add features not explicitly requested**

---

## ‚úÖ WORKING FEATURES (DO NOT BREAK)

| Feature | Status | Last Verified |
|---------|--------|---------------|
| Manual Trader Tab | ‚úÖ WORKING | Dec 3, 2025 |
| Live Position Cards | ‚úÖ WORKING | Dec 3, 2025 |
| Account PnL Display | ‚úÖ WORKING | Dec 3, 2025 |
| Recorders Tab | ‚úÖ WORKING | Dec 3, 2025 |
| Webhook Signals | ‚úÖ WORKING | Dec 3, 2025 |
| Trade Recording | ‚úÖ WORKING | Dec 3, 2025 |
| Dashboard | ‚úÖ WORKING | Dec 3, 2025 |
| Control Center | ‚úÖ WORKING | Dec 3, 2025 |
| Account Management | ‚úÖ WORKING | Dec 3, 2025 |
| Tradovate OAuth | ‚úÖ WORKING | Dec 4, 2025 | **CRITICAL: Uses LIVE+DEMO fallback** |
| WebSocket Updates | ‚úÖ WORKING | Dec 3, 2025 |
| Copy Trading | ‚úÖ WORKING | Dec 3, 2025 |

---

## üìã TAB ISOLATION - MANDATORY

**When user says "work on X tab", ONLY touch files for that tab:**

| Tab | ONLY These Files |
|-----|------------------|
| Manual Trader | `manual_copy_trader.html`, manual trade routes |
| Recorders | `recorders.html`, `recorders_list.html`, recorder routes |
| Dashboard | `dashboard.html`, dashboard routes |
| Control Center | `control_center.html`, control center routes |
| Account Management | **NEVER TOUCH** |

**üö® If you touch a file NOT in the tab's list, YOU ARE BREAKING THE RULES.**

---

## üîß SAFE CHANGE PROCESS

### Step 1: ASK PERMISSION
```
"I want to modify [filename] to [do what]. Is this okay?"
```

### Step 2: WAIT FOR APPROVAL
Do not proceed until user explicitly approves.

### Step 3: ONE SMALL CHANGE
- Edit ONLY the specific lines needed
- Do NOT touch surrounding code
- Do NOT "clean up" other parts

### Step 4: VERIFY
- Test the change works
- Check no regressions

### Step 5: IF BROKEN, RESTORE
```bash
cp backups/WORKING_STATE_DEC3_2025/[filename] ./
# OR
git checkout WORKING_DEC3_2025 -- [filename]
```

---

## üÜò RECOVERY COMMANDS

```bash
# Restore single file from backup
cp backups/WORKING_STATE_DEC3_2025/ultra_simple_server.py ./
cp backups/WORKING_STATE_DEC3_2025/manual_copy_trader.html templates/

# Restore ALL templates
cp backups/WORKING_STATE_DEC3_2025/*.html templates/

# Full git restore to working state
git checkout WORKING_DEC3_2025

# Restart server
pkill -f "python.*ultra_simple"
nohup python3 ultra_simple_server.py > /tmp/server.log 2>&1 &
```

---

## üìö PAST MISTAKES - LEARN FROM THESE

### ‚ùå CRITICAL MISTAKE (Dec 4, 2025): Ignoring all rules completely
**What happened:** 
- AI was told to work on My Traders tab
- AI immediately modified ultra_simple_server.py WITHOUT asking
- AI modified templates/my_traders_tab.html WITHOUT asking
- AI created a new template file WITHOUT asking
- AI made massive bulk changes across multiple files
- When told to undo, AI DELETED a template file instead of restoring it
- AI completely ignored START_HERE.md and .cursorrules
- User had to manually restore files
**Lesson:** 
- ALWAYS ASK BEFORE EVERY SINGLE FILE CHANGE
- NEVER assume permission - wait for explicit "yes"
- NEVER delete files when trying to undo - use git checkout or cp from backup
- ONE small change at a time, then STOP and ask
- READ and FOLLOW the rules - they exist for a reason

### ‚ùå Mistake: Bulk refactoring
**What happened:** AI "improved" code style, broke everything
**Lesson:** NEVER refactor working code

### ‚ùå Mistake: Modifying multiple tabs
**What happened:** Fixed one tab, broke three others
**Lesson:** ONE TAB AT A TIME

### ‚ùå Mistake: Changing database schema
**What happened:** Added columns, broke existing queries
**Lesson:** NEVER change DB schema without approval

### ‚ùå Mistake: Removing "unused" code
**What happened:** Removed code that was actually used elsewhere
**Lesson:** NEVER remove code you didn't write

### ‚ùå Mistake: Making unauthorized changes
**What happened:** AI made changes without asking, broke working features
**Lesson:** ALWAYS ASK FIRST

---

## ‚ö†Ô∏è FINAL WARNING

This codebase has been BROKEN MULTIPLE TIMES by AI making unauthorized changes.

**EVERY SINGLE CHANGE requires:**
1. ‚úÖ User permission (explicit "yes")
2. ‚úÖ Clear explanation BEFORE changing
3. ‚úÖ Single file, minimal edit
4. ‚úÖ Immediate testing
5. ‚úÖ Rollback plan ready

**When in doubt: ASK THE USER.**

**If user hasn't said "yes", DON'T TOUCH IT.**

---

## üîê CRITICAL CODE - NEVER MODIFY WITHOUT UNDERSTANDING

### OAuth Token Exchange (ultra_simple_server.py ~line 1338)
```python
# CRITICAL: Try LIVE first, then DEMO (demo gets rate-limited)
token_endpoints = [
    'https://live.tradovateapi.com/v1/auth/oauthtoken',  # MUST BE FIRST
    'https://demo.tradovateapi.com/v1/auth/oauthtoken'   # Fallback only
]
```
**WHY:** Demo API returns 429 errors for 20+ minutes. LIVE works immediately.
**NEVER:** Use only demo endpoint, remove LIVE, or change the order.

---

*Backup: backups/WORKING_STATE_DEC4_2025_OAUTH_FIX/*
*Git tags: WORKING_DEC3_2025, WORKING_DEC4_2025_OAUTH_FIX*
*Last verified: Dec 4, 2025*
